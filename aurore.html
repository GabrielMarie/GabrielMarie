<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Pr√©vision des Aurores</title>
    <link rel="stylesheet" href="style.css">
    <script>
      const page = window.location.pathname.split("/").pop();
      const root = "/"; // Le site est maintenant √† la racine
      if (!location.href.includes("index.html") && !location.hash) {
          location.replace(root + "#" + page);
      }
    </script>
</head>
<body>
  <header>
    <h1>Aurores bor√©ales</h1>
  </header>
  <main>
    <section class="sujet">
      <h2>üåå Pr√©vision des Aurores</h2>
      <p id="kp-index">Chargement des donn√©es NOAA...</p>
      <p id="kp-message"></p>
      <p style="font-size: 0.9em; color: #777;">Donn√©es fournies par NOAA Space Weather Prediction Center</p>
    </section>
  </main>
 <script>
  fetch('https://muddy-cell-637b.gabriel-saint-gelais.workers.dev/?url=https://services.swpc.noaa.gov/json/planetary_k_index_1m.json')
    .then(res => res.json())
    .then(data => {
      const last = data[data.length - 1];
      const kp = parseFloat(last.kp_index);
      const time = new Date(last.time_tag).toLocaleString('fr-CA', {
        weekday: 'long',
        hour: '2-digit',
        minute: '2-digit'
      });

      document.getElementById('kp-index').innerText = `üì° Indice KP minute : ${kp} (mesur√© ${time})`;

      let message = '';
      if (kp < 3) {
        message = "üßä Aucune chance d'aurores √† votre latitude.";
      } else if (kp < 5) {
        message = "‚ú® Faible chance d‚Äôaurores bor√©ales dans le nord du Qu√©bec.";
      } else if (kp >= 5 && kp < 7) {
        message = "üå† Probabilit√© √©lev√©e d‚Äôaurores dans le nord du Canada.";
      } else if (kp >= 7) {
        message = "üî• Temp√™te g√©omagn√©tique ! Aurores possibles jusqu‚Äôau sud du Qu√©bec.";
      }

      document.getElementById('kp-message').innerText = message;
    })
    .catch(err => {
      document.getElementById('kp-index').innerText = "‚ùå Impossible de r√©cup√©rer les donn√©es KP.";
      console.error(err);
    });
</script>

</body>
</html>
